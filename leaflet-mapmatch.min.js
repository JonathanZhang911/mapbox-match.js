!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.mapmatch=e()}}(function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t){function n(e,t){function n(){xhrOptions={json:"",uri:a,headers:{"Content-Type":"application/json"}},r(xhrOptions,function(e,t,n){e&&console.log(e),console.log(n)})}for(var i=JSON.parse(o.tidy(e,{minimumDistance:20})),s=(L.mapbox.featureLayer().addTo(t),"https://api-directions-johan-matching.tilestream.net/v4/directions/matching/mapbox.driving.json"),a=s+"?"+L.mapbox.accessToken,u=0;u<i.features.length;u++)n(i.features[u])}var r=e("xhr"),o=e("geojson-tidy");t.exports.mapmatch=n},{"geojson-tidy":2,xhr:4}],2:[function(e,t){function n(e,t){function n(e){return JSON.parse(JSON.stringify(e))}t=t||{};for(var o={minimumDistance:t.minimumDistance||10,minimumTime:t.minimumTime||5,maximumPoints:t.maximumPoints||100},i={type:"FeatureCollection",features:[]},s={type:"Feature",properties:{coordTimes:[]},geometry:{type:"LineString",coordinates:[]}},a=0;a<e.features.length;a++)if("LineString"==e.features[a].geometry.type){var u=e.features[a].geometry.coordinates,f=e.features[a].properties.coordTimes;i.features.push(n(s));for(var c=0;c<u.length;c++)if(0!==c&&c!=u.length-1){var p={latitude:u[c][1],longitude:u[c][0]},d={latitude:u[c+1][1],longitude:u[c+1][0]},l=1e3*r(p,d,{unit:"km"});if(!(l<o.minimumDistance)){if(f){var m=new Date(f[c]),h=new Date(f[c+1]),y=(h-m)/1e3;if(y<o.minimumTime)continue}i.features[i.features.length-1].geometry.coordinates.push(u[c]),f&&i.features[i.features.length-1].properties.coordTimes.push(f[c]),i.features[i.features.length-1].geometry.coordinates.length%o.maximumPoints===0&&(i.features.push(n(s)),i.features[i.features.length-1].geometry.coordinates.push(u[c]),f&&i.features[i.features.length-1].properties.coordTimes.push(f[c]))}}else i.features[i.features.length-1].geometry.coordinates.push(u[c]),f&&i.features[i.features.length-1].properties.coordTimes.push(f[c])}return JSON.stringify(i)}var r=e("haversine");t.exports.tidy=n},{haversine:3}],3:[function(e,t){var n=function(){var e=function(e){return e*Math.PI/180};return function(t,n,r){var o=6371,i=3960;r=r||{};var s="mile"===r.unit?i:o,a=e(n.latitude-t.latitude),u=e(n.longitude-t.longitude),f=e(t.latitude),c=e(n.latitude),p=Math.sin(a/2)*Math.sin(a/2)+Math.sin(u/2)*Math.sin(u/2)*Math.cos(f)*Math.cos(c),d=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p));return r.threshold?r.threshold>s*d:s*d}}();t.exports=n},{}],4:[function(e,t){"use strict";function n(e,t){function n(){4===p.readyState&&f()}function r(){var e=void 0;if(p.response?e=p.response:"text"!==p.responseType&&p.responseType||(e=p.responseText||p.responseXML),v)try{e=JSON.parse(e)}catch(t){}return e}function o(e){clearTimeout(l),e instanceof Error||(e=new Error(""+(e||"unknown"))),e.statusCode=0,t(e,c)}function f(){clearTimeout(l);var e=1223===p.status?204:p.status,n=c,o=null;0!==e?(n={body:r(),statusCode:e,method:h,headers:{},url:m,rawRequest:p},p.getAllResponseHeaders&&(n.headers=s(p.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),t(o,n,n.body)}var c={body:void 0,headers:{},statusCode:0,method:h,url:m,rawRequest:p};if("string"==typeof e&&(e={uri:e}),e=e||{},"undefined"==typeof t)throw new Error("callback argument missing");t=i(t);var p=e.xhr||null;p||(p=e.cors||e.useXDR?new u:new a);var d,l,m=p.url=e.uri||e.url,h=p.method=e.method||"GET",y=e.body||e.data,g=p.headers=e.headers||{},w=!!e.sync,v=!1;if("json"in e&&(v=!0,g.Accept||(g.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(g["Content-Type"]="application/json",y=JSON.stringify(e.json))),p.onreadystatechange=n,p.onload=f,p.onerror=o,p.onprogress=function(){},p.ontimeout=o,p.open(h,m,!w,e.username,e.password),w||(p.withCredentials=!!e.withCredentials),!w&&e.timeout>0&&(l=setTimeout(function(){p.abort("timeout")},e.timeout+2)),p.setRequestHeader)for(d in g)g.hasOwnProperty(d)&&p.setRequestHeader(d,g[d]);else if(e.headers)throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(p.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(p),p.send(y),p}function r(){}var o=e("global/window"),i=e("once"),s=e("parse-headers"),a=o.XMLHttpRequest||r,u="withCredentials"in new a?a:o.XDomainRequest;t.exports=n},{"global/window":5,once:6,"parse-headers":10}],5:[function(e,t){(function(e){t.exports="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t){function n(e){var t=!1;return function(){return t?void 0:(t=!0,e.apply(this,arguments))}}t.exports=n,n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0})})},{}],7:[function(e,t){function n(e,t,n){if(!s(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===a.call(e)?r(e,t,n):"string"==typeof e?o(e,t,n):i(e,t,n)}function r(e,t,n){for(var r=0,o=e.length;o>r;r++)u.call(e,r)&&t.call(n,e[r],r,e)}function o(e,t,n){for(var r=0,o=e.length;o>r;r++)t.call(n,e.charAt(r),r,e)}function i(e,t,n){for(var r in e)u.call(e,r)&&t.call(n,e[r],r,e)}var s=e("is-function");t.exports=n;var a=Object.prototype.toString,u=Object.prototype.hasOwnProperty},{"is-function":8}],8:[function(e,t){function n(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=n;var r=Object.prototype.toString},{}],9:[function(e,t,n){function r(e){return e.replace(/^\s*|\s*$/g,"")}n=t.exports=r,n.left=function(e){return e.replace(/^\s*/,"")},n.right=function(e){return e.replace(/\s*$/,"")}},{}],10:[function(e,t){var n=e("trim"),r=e("for-each"),o=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return r(n(e).split("\n"),function(e){var r=e.indexOf(":"),i=n(e.slice(0,r)).toLowerCase(),s=n(e.slice(r+1));"undefined"==typeof t[i]?t[i]=s:o(t[i])?t[i].push(s):t[i]=[t[i],s]}),t}},{"for-each":7,trim:9}]},{},[1])(1)});