<!DOCTYPE html>

<head>
    <meta charset="utf-8" />
    <title>Map match GeoJSONs from GitHub</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css" rel="stylesheet" />
    <script src="../dist/mapbox.map-matching.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <!-- jQuery is required for this example. -->
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script>
        // Provide your access token
        L.mapbox.accessToken = 'pk.eyJ1IjoicGxhbmVtYWQiLCJhIjoiemdYSVVLRSJ9.g3lbg_eN0kztmsfIPxa9MQ';

        var map = L.mapbox.map('map', 'mapbox.streets');
        var featureLayer = L.mapbox.featureLayer().addTo(map);

        var url = 'https://raw.githubusercontent.com/mapbox/mapbox-mapmatch/master/test/a.geojson';

        function load() {
            // Fetch just the contents of a .geojson file from GitHub
            // https://www.mapbox.com/mapbox.js/example/v1.0.0/geojson-marker-from-remote-url/
            $.ajax({
                headers: {
                    'Accept': 'application/vnd.github.v3.raw'
                },
                xhrFields: {
                    withCredentials: false
                },
                dataType: 'json',
                url: url,
                success: function (geojson) {

                    // Mapmatch the geojson with default options
                    L.mapbox.mapmatching(geojson, {}, function (error, layer) {
                        layer.addTo(map).bringToBack();
                        layer.setStyle({
                            color: '#b73800',
                            weight: 15,
                            opacity: 0.3
                        });
                    });

                    // Try foot profile matching
                    L.mapbox.mapmatching(geojson, {
                        gpsPrecision: 20,
                        profile: "foot"
                    }, function (error, layer) {
                        layer.addTo(map);
                        layer.setStyle({
                            color: '#ff0000',
                            weight: 2,
                            opacity: 0.9
                        });

                    });

                    // Draw high confidence matched features
                    L.mapbox.mapmatching(geojson, {
                        profile: "foot",
                        output: "feature"
                    }, function (error, feature) {
                        console.log(feature);
                        for (var i = 0; i < feature.length; i++) {
                            
                            var good_features = $(feature).filter(function (f) {
                                return f.properties.confidence > 0.8;
                            });
                        }

                    });

                    // Compare with the original
                    featureLayer.setGeoJSON(geojson).setStyle({
                        weight: 2,
                        color: 'black',
                        dashArray: '4,4',
                    });
                    map.fitBounds(featureLayer.getBounds());


                }
            });
        }

        $(load);
    </script>
</body>

</html>